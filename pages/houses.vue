<template>
  <div>
    <div class="houses-container">
      <div class="container">
        <div class="page-title-banner houses">
          <h2>
            <svg
              width="33"
              height="36"
              viewBox="0 0 33 36"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M30.5636 10.8301L19.7765 1.37343C18.7876 0.488974 17.5075 0 16.1808 0C14.8541 0 13.574 0.488974 12.5851 1.37343L1.79802 10.8301C1.22697 11.3408 0.771268 11.9674 0.461268 12.668C0.151268 13.3686 -0.00591952 14.1272 0.000170425 14.8933V30.6065C0.000170425 32.0369 0.568417 33.4088 1.5799 34.4203C2.59139 35.4318 3.96326 36 5.39372 36H26.9679C28.3984 36 29.7702 35.4318 30.7817 34.4203C31.7932 33.4088 32.3614 32.0369 32.3614 30.6065V14.8753C32.365 14.1122 32.2066 13.3571 31.8966 12.6598C31.5867 11.9624 31.1324 11.3388 30.5636 10.8301ZM19.7765 32.4043H12.5851V23.4151C12.5851 22.9382 12.7745 22.481 13.1117 22.1438C13.4489 21.8066 13.9061 21.6172 14.383 21.6172H17.9787C18.4555 21.6172 18.9128 21.8066 19.2499 22.1438C19.5871 22.481 19.7765 22.9382 19.7765 23.4151V32.4043ZM28.7657 30.6065C28.7657 31.0833 28.5763 31.5406 28.2392 31.8777C27.902 32.2149 27.4447 32.4043 26.9679 32.4043H23.3722V23.4151C23.3722 21.9846 22.804 20.6127 21.7925 19.6012C20.781 18.5898 19.4091 18.0215 17.9787 18.0215H14.383C12.9525 18.0215 11.5806 18.5898 10.5691 19.6012C9.55766 20.6127 8.98941 21.9846 8.98941 23.4151V32.4043H5.39372C4.9169 32.4043 4.45961 32.2149 4.12245 31.8777C3.78528 31.5406 3.59587 31.0833 3.59587 30.6065V14.8753C3.59619 14.62 3.65087 14.3677 3.75627 14.1352C3.86166 13.9028 4.01536 13.6954 4.20714 13.5269L14.9942 4.08819C15.3223 3.79996 15.7441 3.641 16.1808 3.641C16.6175 3.641 17.0393 3.79996 17.3674 4.08819L28.1545 13.5269C28.3463 13.6954 28.4999 13.9028 28.6053 14.1352C28.7107 14.3677 28.7654 14.62 28.7657 14.8753V30.6065Z"
                fill="white"
              />
            </svg>

            Houses
          </h2>
        </div>

        <div class="section-search mt-3">
          <div class="form-group">
            <div class="search-icon">
              <svg
                width="18"
                height="18"
                viewBox="0 0 18 18"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  fill-rule="evenodd"
                  clip-rule="evenodd"
                  d="M15.4196 18C14.7599 18 14.1273 17.7382 13.6605 17.2721L11.6842 15.2958L11.683 15.2946C11.3191 14.9225 11.0809 14.4455 11.0021 13.931C10.9232 13.4159 11.0079 12.889 11.2444 12.4246L11.3466 12.2237L10.1665 11.0435L9.95123 11.2047C8.6915 12.1474 7.12139 12.578 5.55697 12.4097C3.99255 12.2413 2.54998 11.4866 1.51966 10.2974C0.489337 9.10822 -0.0522314 7.57286 0.00397507 6.00041C0.0601816 4.42796 0.709989 2.93519 1.82259 1.82259C2.93519 0.709989 4.42796 0.0601816 6.00041 0.00397506C7.57286 -0.0522314 9.10822 0.489337 10.2974 1.51966C11.4866 2.54998 12.2413 3.99255 12.4097 5.55697C12.578 7.12139 12.1474 8.6915 11.2047 9.95123L11.0435 10.1665L12.2259 11.3489L12.4219 11.2595C12.8872 11.0473 13.4054 10.9791 13.9098 11.0637C14.4123 11.1479 14.8783 11.38 15.2484 11.7302L17.1761 13.7045L17.3982 13.4877L17.1812 13.7096C17.4183 13.9414 17.6067 14.2183 17.7354 14.524C17.864 14.8297 17.9303 15.158 17.9303 15.4896C17.9303 15.8212 17.864 16.1495 17.7354 16.4552C17.6067 16.7609 17.4183 17.0377 17.1812 17.2696L17.1789 17.2719C16.7121 17.7381 16.0793 18 15.4196 18ZM14.324 12.6065L16.3008 14.5833C16.4171 14.6988 16.51 14.8367 16.573 14.988C16.6361 15.1395 16.6687 15.3021 16.6687 15.4663C16.6687 15.6304 16.6361 15.793 16.573 15.9445C16.51 16.0957 16.4178 16.2329 16.3017 16.3484C16.1863 16.4645 16.049 16.5567 15.8979 16.6197C15.7463 16.6828 15.5838 16.7153 15.4196 16.7153C15.2554 16.7153 15.0929 16.6828 14.9413 16.6197C14.79 16.5566 14.6527 16.4643 14.5372 16.348L12.5598 14.3707C12.4436 14.2552 12.3507 14.1173 12.2876 13.966C12.2245 13.8144 12.192 13.6519 12.192 13.4877C12.192 13.3235 12.2245 13.161 12.2876 13.0094C12.3506 12.8583 12.4428 12.721 12.5589 12.6056C12.6744 12.4895 12.8116 12.3973 12.9628 12.3343C13.1143 12.2712 13.2769 12.2386 13.441 12.2386C13.6052 12.2386 13.7678 12.2712 13.9193 12.3343C14.0707 12.3974 14.2085 12.4901 14.324 12.6065ZM7.15467 11.1088C8.11973 10.9178 9.00653 10.445 9.70305 9.75027C10.1665 9.28796 10.5342 8.73877 10.7851 8.13414C11.036 7.5295 11.1652 6.88131 11.1652 6.22669C11.1652 5.57207 11.036 4.92388 10.7851 4.31925C10.5342 3.71461 10.1665 3.16542 9.70305 2.70312C9.00653 2.00836 8.11973 1.53561 7.15467 1.3446C6.18961 1.15359 5.18958 1.25288 4.28092 1.62993C3.37227 2.00699 2.59574 2.64488 2.04944 3.46304C1.50314 4.2812 1.21157 5.24291 1.21157 6.22669C1.21157 7.21047 1.50314 8.17219 2.04944 8.99035C2.59574 9.8085 3.37227 10.4464 4.28092 10.8235C5.18958 11.2005 6.18961 11.2998 7.15467 11.1088Z"
                  fill="#C0C0C0"
                ></path>
              </svg>
            </div>
            <input type="text" class="form-control" v-model="house_search" placeholder="Search" />
          </div>
        </div>

        <div class="houses-page">
          <div class="houses-wrapper">
            <div class="title-header">
              <div class="row">
                <div class="col-md-10">
                  <div class="section-heading small green">
                    <h4 class="ms-3">
                      <svg
                        width="17"
                        height="18"
                        viewBox="0 0 17 18"
                        fill="none"
                        xmlns="http://www.w3.org/2000/svg"
                      >
                        <path
                          d="M15.2818 5.41506L9.88825 0.686717C9.39382 0.244487 8.75375 0 8.0904 0C7.42706 0 6.78698 0.244487 6.29256 0.686717L0.899009 5.41506C0.613483 5.67042 0.385634 5.98368 0.230634 6.33398C0.0756342 6.68428 -0.00295976 7.06358 8.52127e-05 7.44663V15.3032C8.52127e-05 16.0185 0.284209 16.7044 0.789952 17.2101C1.29569 17.7159 1.98163 18 2.69686 18H13.4839C14.1992 18 14.8851 17.7159 15.3909 17.2101C15.8966 16.7044 16.1807 16.0185 16.1807 15.3032V7.43764C16.1825 7.0561 16.1033 6.67853 15.9483 6.32988C15.7934 5.98122 15.5662 5.66942 15.2818 5.41506ZM9.88825 16.2022H6.29256V11.7075C6.29256 11.4691 6.38726 11.2405 6.55584 11.0719C6.72443 10.9033 6.95307 10.8086 7.19148 10.8086H8.98933C9.22774 10.8086 9.45638 10.9033 9.62496 11.0719C9.79354 11.2405 9.88825 11.4691 9.88825 11.7075V16.2022ZM14.3829 15.3032C14.3829 15.5416 14.2882 15.7703 14.1196 15.9389C13.951 16.1074 13.7224 16.2022 13.4839 16.2022H11.6861V11.7075C11.6861 10.9923 11.402 10.3064 10.8962 9.80062C10.3905 9.29488 9.70456 9.01076 8.98933 9.01076H7.19148C6.47625 9.01076 5.79032 9.29488 5.28457 9.80062C4.77883 10.3064 4.49471 10.9923 4.49471 11.7075V16.2022H2.69686C2.45845 16.2022 2.2298 16.1074 2.06122 15.9389C1.89264 15.7703 1.79793 15.5416 1.79793 15.3032V7.43764C1.7981 7.31 1.82543 7.18387 1.87813 7.06762C1.93083 6.95138 2.00768 6.84768 2.10357 6.76345L7.49711 2.04409C7.66116 1.89998 7.87205 1.8205 8.0904 1.8205C8.30876 1.8205 8.51965 1.89998 8.68369 2.04409L14.0772 6.76345C14.1731 6.84768 14.25 6.95138 14.3027 7.06762C14.3554 7.18387 14.3827 7.31 14.3829 7.43764V15.3032Z"
                          fill="#1F1F1F"
                        />
                      </svg>

                      Houses
                    </h4>
                  </div>
                </div>
                <div class="col-md-2 header-buttons">
                  <button
                    data-bs-toggle="modal"
                    @click="openAddHouseModalPopUp()"
                    class="btn btn-success"
                  >
                    <svg
                      width="18"
                      height="18"
                      viewBox="0 0 18 18"
                      fill="none"
                      xmlns="http://www.w3.org/2000/svg"
                    >
                      <path
                        d="M9 0C7.21997 0 5.47991 0.527841 3.99987 1.51677C2.51983 2.50571 1.36628 3.91131 0.685088 5.55585C0.00389956 7.20038 -0.17433 9.00998 0.172936 10.7558C0.520203 12.5016 1.37737 14.1053 2.63604 15.364C3.89471 16.6226 5.49836 17.4798 7.24419 17.8271C8.99002 18.1743 10.7996 17.9961 12.4442 17.3149C14.0887 16.6337 15.4943 15.4802 16.4832 14.0001C17.4722 12.5201 18 10.78 18 9C18 7.8181 17.7672 6.64778 17.3149 5.55585C16.8626 4.46392 16.1997 3.47177 15.364 2.63604C14.5282 1.80031 13.5361 1.13738 12.4442 0.685084C11.3522 0.232792 10.1819 0 9 0ZM9 16.2C7.57598 16.2 6.18393 15.7777 4.9999 14.9866C3.81586 14.1954 2.89302 13.0709 2.34807 11.7553C1.80312 10.4397 1.66054 8.99201 1.93835 7.59535C2.21616 6.19868 2.9019 4.91577 3.90883 3.90883C4.91577 2.90189 6.19869 2.21616 7.59535 1.93835C8.99201 1.66053 10.4397 1.80312 11.7553 2.34807C13.0709 2.89302 14.1954 3.81586 14.9866 4.99989C15.7777 6.18393 16.2 7.57597 16.2 9C16.2 10.9096 15.4414 12.7409 14.0912 14.0912C12.7409 15.4414 10.9096 16.2 9 16.2ZM12.6 8.1H9.9V5.4C9.9 5.1613 9.80518 4.93239 9.6364 4.7636C9.46762 4.59482 9.2387 4.5 9 4.5C8.76131 4.5 8.53239 4.59482 8.36361 4.7636C8.19482 4.93239 8.1 5.1613 8.1 5.4V8.1H5.4C5.16131 8.1 4.93239 8.19482 4.76361 8.3636C4.59482 8.53238 4.5 8.7613 4.5 9C4.5 9.23869 4.59482 9.46761 4.76361 9.63639C4.93239 9.80518 5.16131 9.9 5.4 9.9H8.1V12.6C8.1 12.8387 8.19482 13.0676 8.36361 13.2364C8.53239 13.4052 8.76131 13.5 9 13.5C9.2387 13.5 9.46762 13.4052 9.6364 13.2364C9.80518 13.0676 9.9 12.8387 9.9 12.6V9.9H12.6C12.8387 9.9 13.0676 9.80518 13.2364 9.63639C13.4052 9.46761 13.5 9.23869 13.5 9C13.5 8.7613 13.4052 8.53238 13.2364 8.3636C13.0676 8.19482 12.8387 8.1 12.6 8.1Z"
                        fill="white"
                      />
                    </svg>
                    Add House
                  </button>
                </div>
              </div>
            </div>

            <input type="hidden" :value="setHouseListFilteredComputed" />

            <div class="houses-list" v-if="housesListFilteredComputed.length > 0">
              <house-list-item v-for="(house, index) in housesListFilteredComputed" :key="index" :selectedindex="index" :house="house"></house-list-item>
            </div>
            <div v-else class="no-data">
                <div>
                    <svg
                    width="13"
                    height="14"
                    viewBox="0 0 13 14"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg">
                        <path
                            d="M11.8858 4.21171L7.69086 0.534113C7.30631 0.190156 6.80847 0 6.29254 0C5.7766 0 5.27877 0.190156 4.89421 0.534113L0.69923 4.21171C0.477153 4.41033 0.299937 4.65397 0.179382 4.92643C0.0588266 5.19888 -0.00230204 5.4939 6.62766e-05 5.79182V11.9025C6.62766e-05 12.4588 0.221051 12.9923 0.614407 13.3857C1.00776 13.779 1.54127 14 2.09756 14H10.4875C11.0438 14 11.5773 13.779 11.9707 13.3857C12.364 12.9923 12.585 12.4588 12.585 11.9025V5.78483C12.5864 5.48808 12.5248 5.19442 12.4042 4.92324C12.2837 4.65206 12.107 4.40955 11.8858 4.21171ZM7.69086 12.6017H4.89421V9.10586C4.89421 8.92043 4.96787 8.74259 5.09899 8.61147C5.23011 8.48036 5.40794 8.40669 5.59337 8.40669H6.9917C7.17713 8.40669 7.35496 8.48036 7.48608 8.61147C7.6172 8.74259 7.69086 8.92043 7.69086 9.10586V12.6017ZM11.1867 11.9025C11.1867 12.0879 11.113 12.2658 10.9819 12.3969C10.8508 12.528 10.6729 12.6017 10.4875 12.6017H9.08919V9.10586C9.08919 8.54957 8.8682 8.01606 8.47485 7.62271C8.08149 7.22935 7.54799 7.00837 6.9917 7.00837H5.59337C5.03708 7.00837 4.50358 7.22935 4.11022 7.62271C3.71687 8.01606 3.49588 8.54957 3.49588 9.10586V12.6017H2.09756C1.91213 12.6017 1.73429 12.528 1.60317 12.3969C1.47205 12.2658 1.39839 12.0879 1.39839 11.9025V5.78483C1.39852 5.68556 1.41978 5.58745 1.46077 5.49704C1.50176 5.40663 1.56153 5.32598 1.63611 5.26046L5.83109 1.58985C5.95868 1.47776 6.1227 1.41594 6.29254 1.41594C6.46237 1.41594 6.62639 1.47776 6.75398 1.58985L10.949 5.26046C11.0235 5.32598 11.0833 5.40663 11.1243 5.49704C11.1653 5.58745 11.1866 5.68556 11.1867 5.78483V11.9025Z"
                            fill="#1F1F1F" />
                    </svg> 
                    <h4>No Houses</h4>
                </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <edit-house-modal />
    <delete-house-modal />
    <link-house-to-profile-modal />
    <unlink-house-modal />
  </div>
</template>

<script>
import { mapGetters } from 'vuex'
import editHouseModal from '~/components/houses/editHouseModal.vue'
import deleteHouseModal from '~/components/houses/deleteHouseModal.vue'
import linkHouseToProfileModal from '~/components/houses/linkHouseToProfileModal.vue'
import UnlinkHouseModal from '~/components/houses/unlinkHouseModal.vue'
import houseListItem from '~/components/houses/houseListItem.vue'
export default {
  name: 'Houses',
  components: { houseListItem, editHouseModal, deleteHouseModal, linkHouseToProfileModal, UnlinkHouseModal },
  layout: 'master',

  data () {
    return {
      housesListFiltered: [],
      house_search: ''

    }
  },
  watch:{
    house_search(newValue, oldValue) {
      if(newValue.length > 2){
          this.filterHouses(newValue)
      }else {
          this.housesListFiltered = this.housesList
      }
    }
  },

  computed: {
    housesListFilteredComputed() {
      return this.housesListFiltered
    },
    setHouseListFilteredComputed() {
      this.housesListFiltered = this.housesList
      return 1
    },
    ...mapGetters({
      housesList: 'house/getAllHouses'
    })
  },
  mounted () {
    this.fetchAllHouses()
    this.$store.commit('setActiveTab', 'search')
  },
  methods: {
    openAddHouseModalPopUp () {
      this.$store.commit('house/setIsEditHousePopupOpen', { isEditHousePopupOpen: true, selectedHouseObj: null , selectedindex: 0 })
    },
    async fetchAllHouses () {
      await this.$store.dispatch(
        'house/fetchAllHouses',
        {}
      )
    },
    filterHouses(searchedName) {
        searchedName = searchedName.toLowerCase()
        var list = this.housesList

        const filtered = list.filter( (
              house,
              index,
              array
          ) => {
              let name = house.house_name.toLowerCase()
              if (name.includes(searchedName)) {
              return true
              } else {
              return false
              }
          })
          this.housesListFiltered = filtered
    }
  }
}

</script>

<style lang="css">
.page-title-banner.houses {
  background: url("~/assets/images/houses-banner.png") no-repeat;
  background-size: 100% !important;
}
.header-buttons {
  margin-top: 12px;
  text-align: right;
}
.header-buttons .btn {
  width: 150px;
  font-weight: 500;
}

.houses-item {
  background: #ffffff;
  border-radius: 15px;
  padding: 10px;
  align-items: center;
  margin-bottom: 10px;
}
.houses-item .hosue-img {
  margin-right: 10px;
}
.houses-item .hosue-img img {
  max-width: 100px;
  height: 55px;
}
.houses-item .house-name .label,
.houses-item .house-price .label {
  font-size: 14px;
  color: rgba(27, 27, 27, 0.5);
}
.houses-item .house-name h4 {
  font-size: 14px;
}

.owner-cell {
  display: flex;
  align-items: center;
}
.house-owner-card {
  display: flex;
  align-items: center;
  background: #f7f7f7;
  border-radius: 10px;
  padding: 10px;
  width: 300px;
  margin-left: 15px;
}
.house-owner-card .owner-pic {
  width: 48px;
  height: 48px;
}
.house-owner-card .owner-pic img {
  max-width: 100%;
  border-radius: 10px;
}
.house-owner-card .owner-info {
  margin-left: 10px;
}
.house-owner-card .owner-info h3 {
  font-size: 18px;
  margin-bottom: 0;
}
.house-owner-card .owner-info h4 {
  font-size: 14px;
  font-weight: normal;
  margin-bottom: 0;
  color: rgba(27, 27, 27, 0.5);
}
.house-owner-card .unlink-btn .btn-danger {
  height: 40px;
  width: 40px;
  padding: 0;
  text-align: center;
}

.houses-item .right-column {
  display: flex;
  width: 50%;
  align-items: center;
  margin-left: auto;
}
.houses-item .house-price {
  font-size: 12px;
  margin-left: 20px;
}
.unlink-btn {
  margin-left: auto;
}
.column-1 {
  display: flex;
}
.column-2 {
  display: flex;
}
.column-3 {
  display: flex;
  justify-content: flex-end;
}
.houses-item .action-dropdown {
  margin-left: 20px;
}
.houses-item .action-dropdown .dropdown-item {
  font-size: 14px;
}
@media (min-width: 576px) {
  .add-house-modal {
    max-width: 426px;
    margin: 1.75rem auto;
  }
  .edit-house-modal {
    max-width: 460px;
    margin: 1.75rem auto;
  }
}

.add-house-modal .modal-content {
  border-radius: 15px;
}
.modal .house-owner-card {
  width: 100%;
  margin-left: 0;
}
.add-house-modal .add-picture {
  background: #fcfcfc;
  border-radius: 10px;
  display: flex;
  justify-content: center;
  align-items: center;
  height: 380px;
  cursor: pointer;
}
.add-picture input[type="file"],
.add-picture input[type="file"] {
  display: none;
}
.house-pic {
  position: relative;
}
.house-pic > img {
  max-width: 100%;
  width: 100%;
}
.house-pic .add-picture {
  position: absolute;
  display: flex;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  align-items: center;
  justify-content: center;
  cursor: pointer;
}
.edit-house-modal .form-control {
  font-size: 14px;
}
</style>
